<!-- File: audiobook_automated/templates/search.html -->
{% extends "base.html" %} {% block title %}{{ site_title }} - Search{% endblock %} {% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/flatpickr.min.css', v=static_version) }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/nouislider.min.css', v=static_version) }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/search.css', v=static_version) }}" />
{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='vendor/js/flatpickr.min.js', v=static_version) }}"></script>
<script src="{{ url_for('static', filename='vendor/js/nouislider.min.js', v=static_version) }}"></script>
<script src="{{ url_for('static', filename='js/search.js', v=static_version) }}" defer></script>
{% endblock %} {% block content %}

<div class="search-container" id="search-container">
    <form method="get" class="search-form" id="search-form">
        <input type="text" name="query" placeholder="Enter book name" class="search-bar" value="{{ query }}" required />
        <button type="submit" class="search-button">
            <span class="button-text">Search</span>
            <div class="button-spinner" id="button-spinner" style="display: none">
                <div class="spinner"></div>
            </div>
        </button>
    </form>
</div>
<div class="message-scroller" id="message-scroller">
    <p id="scrolling-message"></p>
</div>

{% if error %}
<p class="error-message">{{ error }}</p>
{% endif %} {% if books %}
<div id="filter-container">
    <div class="filter-row">
        <div class="filter-controls">
            <select id="category-filter">
                <option value="">All Categories</option>
            </select>
            <select id="language-filter">
                <option value="">All Languages</option>
            </select>
            <select id="bitrate-filter">
                <option value="">All Bitrates</option>
            </select>
            <select id="format-filter">
                <option value="">All Formats</option>
            </select>
            <input type="text" id="date-range-filter" placeholder="Select Date Range" />
        </div>
    </div>
    <div class="filter-row filter-row-bottom">
        <div class="filter-controls">
            <div class="file-size-filter-wrapper">
                <label>File Size:</label>
                <div id="file-size-slider"></div>
            </div>
        </div>
        <div class="filter-buttons">
            <button id="filter-button" class="btn-primary">Filter</button>
            <button id="clear-button" class="btn-glass">Clear</button>
        </div>
    </div>

    <!-- View Toggle -->
    <div class="view-toggle-row">
        <div class="view-toggle-container">
            <button class="view-btn active" id="view-list-btn" aria-label="List View">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="8" y1="6" x2="21" y2="6"></line>
                    <line x1="8" y1="12" x2="21" y2="12"></line>
                    <line x1="8" y1="18" x2="21" y2="18"></line>
                    <line x1="3" y1="6" x2="3.01" y2="6"></line>
                    <line x1="3" y1="12" x2="3.01" y2="12"></line>
                    <line x1="3" y1="18" x2="3.01" y2="18"></line>
                </svg>
                List
            </button>
            <button class="view-btn" id="view-grid-btn" aria-label="Grid View">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="7" height="7"></rect>
                    <rect x="14" y="3" width="7" height="7"></rect>
                    <rect x="14" y="14" width="7" height="7"></rect>
                    <rect x="3" y="14" width="7" height="7"></rect>
                </svg>
                Grid
            </button>
        </div>
    </div>
</div>
{% endif %}

<div class="table-wrapper" id="results-container">
    <table>
        <tbody id="results-table-body">
            {% if books %} {% for book in books %} {% set default_cover_url = url_for('static', filename='images/' +
            default_cover_filename, v=static_version) %}
            <tr
                class="result-row"
                data-category="{{ book.category|join('|') }}"
                data-language="{{ book.language }}"
                data-bitrate="{{ book.bitrate }}"
                data-format="{{ book.format }}"
                data-file-size="{{ book.file_size }}"
                data-post-date="{{ book.post_date }}"
            >
                <td>
                    <a href="{{ url_for('main.details', link=book.link) }}">
                        <img
                            src="{{ book.cover if book.cover else default_cover_url }}"
                            alt="Cover Art"
                            class="cover"
                            width="100"
                            data-default-cover="{{ url_for('static', filename='images/' + default_cover_filename, v=static_version) }}"
                        />
                    </a>
                </td>
                <td>
                    <p class="book-title">{{ book.title }}</p>

                    <div class="categories-container">
                        {# Render individual pills for both Grid and List views #} {% for raw_cat in book.category %} {%
                        for cat in raw_cat.split(',') %} {% if cat.strip() %}
                        <span class="category-tag">{{ cat.strip() }}</span>
                        {% endif %} {% endfor %} {% endfor %}
                    </div>

                    <div class="property-results-container">
                        <span class="book-language">Language: {{ book.language }}</span>
                        <span class="book-bitrate">Bitrate: {{ book.bitrate }}</span>
                        <span class="book-format">Format: {{ book.format }}</span>
                        <span class="book-file_size">File Size: {{ book.file_size }}</span>
                        <span class="book-post_date">Posted: {{ book.post_date }}</span>
                    </div>
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{{ url_for('main.details', link=book.link) }}" class="btn-glass details-button"
                            >Details</a
                        >
                        <button
                            class="btn-primary send-torrent-btn"
                            data-link="{{ book.link|escape }}"
                            data-title="{{ book.title|escape }}"
                        >
                            Download
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %} {% else %} {% if query %}
            <tr>
                <td colspan="3" class="empty-message">
                    No audiobooks found for "<strong>{{ query }}</strong>". <br />
                    <small>Try a different keyword or check spelling.</small>
                </td>
            </tr>
            {% endif %} {% endif %}
        </tbody>
    </table>
</div>

{% endblock %}
