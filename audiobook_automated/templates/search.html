{% extends "base.html" %} {% block title %}Search{% endblock %} {% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/flatpickr.min.css', v=static_version) }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='vendor/css/nouislider.min.css', v=static_version) }}" />
<link rel="stylesheet" href="{{ url_for('static', filename='css/search.css', v=static_version) }}" />
{% endblock %} {% block extra_js %}
<script src="{{ url_for('static', filename='vendor/js/flatpickr.min.js', v=static_version) }}"></script>
<script src="{{ url_for('static', filename='vendor/js/nouislider.min.js', v=static_version) }}"></script>
<script src="{{ url_for('static', filename='js/search.js', v=static_version) }}" defer></script>
{% endblock %} {% block content %}

<div class="title-container">
    <h1>Search AudiobookBay</h1>
</div>

<div class="search-container" id="search-container">
    <form method="get" class="search-form" onsubmit="showLoadingSpinner()">
        <input
            type="text"
            name="query"
            placeholder="Enter book title, author, or narrator..."
            class="search-bar"
            value="{{ query }}"
            required
        />
        <button type="submit" class="search-button">
            <span class="button-text">Search</span>
            <div class="button-spinner" id="button-spinner" style="display: none">
                <div class="spinner"></div>
            </div>
        </button>
    </form>
</div>

<div class="message-scroller" id="message-scroller" style="text-align: center; margin-bottom: 20px">
    <p id="scrolling-message"></p>
</div>

{% if error %}
<p class="error-message">{{ error }}</p>
{% endif %} {% if books %}
<div id="filter-container">
    <div class="filter-row">
        <div class="filter-controls">
            <select id="category-filter">
                <option value="">All Categories</option>
            </select>
            <select id="language-filter">
                <option value="">All Languages</option>
            </select>
            <select id="bitrate-filter">
                <option value="">All Bitrates</option>
            </select>
            <select id="format-filter">
                <option value="">All Formats</option>
            </select>
            <input type="text" id="date-range-filter" placeholder="Date Range" />
        </div>
        <div class="filter-buttons">
            <button id="filter-button">Filter</button>
        </div>
    </div>
    <div class="filter-row">
        <div class="file-size-filter-wrapper">
            <label>Size:</label>
            <div id="file-size-slider"></div>
        </div>
        <div class="filter-buttons">
            <button id="clear-button">Clear</button>
        </div>
    </div>
</div>
{% endif %}

<div class="table-wrapper">
    <table>
        <tbody id="results-table-body">
            {% if books %} {% for book in books %} {% set default_cover_url = url_for('static', filename='images/' +
            default_cover_filename, v=static_version) %}
            <tr
                class="result-row"
                data-category="{{ book.category }}"
                data-language="{{ book.language }}"
                data-bitrate="{{ book.bitrate }}"
                data-format="{{ book.format }}"
                data-file-size="{{ book.file_size }}"
                data-post-date="{{ book.post_date }}"
            >
                <td>
                    <img
                        src="{{ book.cover if book.cover else default_cover_url }}"
                        alt="Cover"
                        class="cover"
                        data-default-cover="{{ default_cover_url }}"
                        onerror="
                            this.onerror = null;
                            this.src = this.dataset.defaultCover;
                        "
                    />
                </td>
                <td>
                    <p class="book-title">{{ book.title }}</p>
                    <div class="property-results-container">
                        <span class="book-category">{{ book.category }}</span>
                        <span>Language: {{ book.language }}</span>
                        <span>Format: {{ book.format }} / {{ book.bitrate }}</span>
                        <span>Size: {{ book.file_size }}</span>
                        <span>Posted: {{ book.post_date }}</span>
                    </div>
                </td>
                <td>
                    <a href="{{ url_for('main.details', link=book.link) }}" class="details-button">Details</a>
                    <button onclick="sendTorrent('{{ book.link|escape }}', '{{ book.title|escape }}', this)">
                        Download
                    </button>
                </td>
            </tr>
            {% endfor %} {% else %} {% if query %}
            <tr>
                <td colspan="3">
                    <div class="empty-message" style="text-align: center; padding: 40px; color: var(--text-muted)">
                        No audiobooks found for "<strong>{{ query }}</strong>". <br />
                        <small>Try a different keyword or check spelling.</small>
                    </div>
                </td>
            </tr>
            {% endif %} {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}
